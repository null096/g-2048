(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{16:function(e,t,n){e.exports={tileSize:"100px",spaceBetweenTiles:"12px"}},21:function(e,t,n){e.exports=n(35)},34:function(e,t,n){e.exports={tileSize:"100px",spaceBetweenTiles:"12px"}},35:function(e,t,n){"use strict";n.r(t);var i=n(0),r=n.n(i),a=n(7),o=n.n(a),l=n(5),s=n(4),c=n(6),u=n(13),d=n(11),f=n(14),v=n(8),m=n(10),b=function(){function e(){Object(s.a)(this,e)}return Object(c.a)(e,null,[{key:"getObjectProp",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];if(!n.length)return e;for(var r=e[n[0]],a=1;a<n.length;a++){if(!(r instanceof Object))return;r=r[n[a]]}return r}}]),e}(),g=n(15),h=n.n(g),y=function e(t){var n=t.score,i=t.id,r=void 0===i?e.uuid.next().value:i,a=t.x,o=t.y,l=t.mergeTileId,c=t.isNew,u=void 0!==c&&c;Object(s.a)(this,e),this.score=n,this.id=r,this.x=a,this.y=o,this.mergeTileId=l,this.isNew=u};y.uuid=h.a.mark(function e(){var t;return h.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=1;case 1:return e.next=4,t++;case 4:e.next=1;break;case 6:case"end":return e.stop()}},e)})();var p=y,w=n(19),O=n.n(w),k=4,j=4,F="right",T="left",E="toLeft",x="toRight",M="toDown",A="toUp",W=function(){function e(){Object(s.a)(this,e)}return Object(c.a)(e,null,[{key:"getEmptyField",value:function(e){var t=e.x,n=e.y;return Object(m.a)(Array(n).fill([]).map(function(e){return Object(m.a)(Array(t))}))}},{key:"getRandomArrayIndex",value:function(e){return~~(Math.random()*e)}},{key:"getFieldCopy",value:function(t){return new Array(t.length).fill([]).map(function(n,i){return e.getLineCopy(t[i])})}},{key:"getLineCopy",value:function(t){return t.map(e.getTileCopy)}},{key:"getTileCopy",value:function(e){return e?new p(Object(v.a)({},e)):e}},{key:"getNewTile",value:function(){var t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).score,n=void 0===t?e.getScoreForNewTile():t;return new p({score:n,isNew:!0})}},{key:"getScoreForNewTile",value:function(){return Math.random()>.9090909?4:2}},{key:"getFieldLength",value:function(e){return{xLen:e[0].length,yLen:e.length}}},{key:"addTile",value:function(t){var n=t.field,i=t.amount,r=void 0===i?1:i,a=e.getRandomArrayIndex,o=e.getNewTile,l=e.getFieldCopy,s=e.getEmptyTiles;if(r<1)return n;var c=s(n);if(r>c.length)return{isFieldFull:!0,field:n};for(var u=l(n);r--;){var d=a(c.length),f=c[d],v=f.x,m=f.y;c.splice(d,1),u[m][v]=o()}return{field:u}}},{key:"getEmptyTiles",value:function(e){var t=[];return e.forEach(function(e,n){e.forEach(function(e,i){!e&&t.push({y:n,x:i})})}),t}},{key:"mergeTilesTo",value:function(t,n){var i=n.dir,r=e.reverseFieldLines,a=e.rotateFieldToRight,o=e.rotateFieldToLeft,l=e.applyMerge;switch(i){case E:return l({field:t});case x:return l({field:t,rotateFn:r,rotateBackFn:r});case A:return l({field:t,rotateFn:o,rotateBackFn:a});case M:return l({field:t,rotateFn:a,rotateBackFn:o});default:return new Error("Wrong direction")}}},{key:"applyMerge",value:function(t){var n,i=t.field,r=t.rotateFn,a=void 0===r?function(e){return e}:r,o=t.rotateBackFn,l=void 0===o?function(e){return e}:o;return{field:l((n=(0,e.mergeAllLines)(a(i))).field),removed:l(n.removed),score:n.score}}},{key:"getFlattenTilesWithPositions",value:function(t){var n=t.field,i=t.removed,r=e.addPositionForFieldTiles,a=e.addPositionForRemovedTiles,o=r(n),l=a(n,i),s=[].concat(Object(m.a)(o),Object(m.a)(l||[])).flat(1);return O()(s.filter(Boolean),"id")}},{key:"addPositionForRemovedTiles",value:function(t,n){if(n){var i=e.getFieldCopy,r=e.getTilesPosition,a=i(n),o=r(t);return a.map(function(e){return e.map(function(e){if(!e)return e;var t=o[e.mergeTileId];return new p(Object(v.a)({},e,{x:t.x,y:t.y}))})})}}},{key:"addPositionForFieldTiles",value:function(t){return(0,e.getFieldCopy)(t).map(function(e,t){return e.map(function(e,n){return e?new p(Object(v.a)({},e,{y:t,x:n})):e})})}},{key:"getTilesPosition",value:function(e){var t={};return e.forEach(function(e,n){e.forEach(function(e,i){e&&(t[e.id]={x:i,y:n})})}),t}},{key:"resetPropsOnField",value:function(t,n){return(0,e.getFieldCopy)(t).map(function(e){return e.map(function(e){return e?(n.forEach(function(t){e[t]=void 0}),e):e})})}},{key:"mergeTileLine",value:function(t){for(var n=t.line,i=t.lineY,r=t.gameData,a=e.getNewTile,o=r.removed[i],l=0,s=1;s<n.length;s++)if(n[l]&&n[s]&&n[l].score===n[s].score){var c=2*n[l].score,u=a({score:c});o[l]=new p(Object(v.a)({},n[l],{mergeTileId:u.id})),o[s]=new p(Object(v.a)({},n[s],{mergeTileId:u.id})),r.score+=c,n[l]=u,n[s]=void 0,l++}else n[s]&&(n[l]&&l++,n[l]=n[s],l!==s&&(n[s]=void 0));return n}},{key:"isFieldsEqual",value:function(t,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:["id"],r=e.getFieldLength,a=r(t),o=a.xLen,l=a.yLen,s=r(n),c=s.xLen,u=s.yLen;return o===c&&l===u&&t.every(function(e,t){return e.every(function(e,r){var a=n[t][r];return e&&a?i.every(function(t){return e[t]===a[t]}):e===a})})}},{key:"isWinCheck",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2048;return e.some(function(e){return e.some(function(e){return!!e&&e.score>=t})})}},{key:"isAnyTileEmpty",value:function(e){return e.some(function(e){return e.some(function(e){return!e})})}},{key:"isFieldHasMergeableTiles",value:function(e){var t=b.getObjectProp;return e.some(function(n,i){return n.some(function(n,r){return!!n&&[t(e,i-1,r),t(e,i+1,r),t(e,i,r-1),t(e,i,r+1)].filter(Boolean).map(function(e){return e.score}).includes(n.score)})})}},{key:"isMoveAvailableCheck",value:function(t){var n=e.isAnyTileEmpty,i=e.isFieldHasMergeableTiles;return!!n(t)||i(t)}}]),e}();W.mergeAllLines=function(e){var t=W.getFieldLength,n=W.getEmptyField,i=W.mergeTileLine,r=(0,W.resetPropsOnField)(e,["isNew"]),a=t(r),o={removed:n({x:a.xLen,y:a.yLen}),score:0};return r.map(function(e,t){return i({line:e,lineY:t,gameData:o})}),Object(v.a)({field:r},o)},W.rotateRL=function(e){var t=e.to;return function(e){var n=W.getFieldLength(e),i=n.yLen,r=n.xLen,a=W.getEmptyField({x:i,y:r});switch(t){case F:e.forEach(function(e,t){e.forEach(function(e,n){a[n][i-t-1]=W.getTileCopy(e)})});break;case T:e.forEach(function(e,t){e.forEach(function(e,n){a[r-n-1][t]=W.getTileCopy(e)})});break;default:return new Error("Wrong direction")}return a}},W.rotateFieldToRight=W.rotateRL({to:F}),W.rotateFieldToLeft=W.rotateRL({to:T}),W.reverseFieldLines=function(e){return W.getFieldCopy(e).map(function(e){return e.reverse()})};var C,L,N,S,I,P,z,R,B,D,U,K,G,Y,q,H,J,V=W,X=function(e){var t=e.x,n=e.y,i=V.getEmptyField({x:t,y:n});return r.a.createElement("div",{className:"field"},i.map(function(e,t){return r.a.createElement("div",{className:"field-line",key:"field-line-".concat(t)},e.map(function(e,t){return r.a.createElement("div",{className:"empty-tile",key:"empty-tile-".concat(t)})}))}))},$=n(20),Q=n.n($),Z=n(9),_=n(12),ee=n(16),te=n.n(ee),ne=parseInt(te.a.tileSize),ie=parseInt(te.a.spaceBetweenTiles),re=function(e){return(e+1)*ie+e*ne},ae="position",oe="onNew",le="initialPose",se=_.a.div((C={},Object(Z.a)(C,ae,{x:function(e){var t=e.x;return re(t)},y:function(e){var t=e.y;return re(t)},scale:1,transition:{x:{duration:175},y:{duration:175},scale:{duration:0}}}),Object(Z.a)(C,oe,{x:function(e){var t=e.x;return re(t)},y:function(e){var t=e.y;return re(t)},scale:.8,opacity:0,transition:{x:{duration:0},y:{duration:0},scale:function(){return{type:"keyframes",times:[0,.5,1],values:[.8,1.1,1],duration:250}},opacity:function(){return{type:"keyframes",times:[0,.3],values:[0,1],duration:250}}}}),Object(Z.a)(C,le,{}),C)),ce=Object(l.c)(function(e){var t=e.tile,n=Q()("tile","tile-".concat(t.score),{"tile-removed":t.mergeTileId});return r.a.createElement(se,{className:n,pose:t.isNew?oe:ae,initialPose:le,x:t.x,y:t.y,poseKey:"".concat(t.x,"-").concat(t.y)},t.score)}),ue=Object(l.c)(L=function(e){function t(){return Object(s.a)(this,t),Object(u.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(f.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this.props,t=e.field,n=e.removed,i=(0,V.getFlattenTilesWithPositions)({field:t,removed:n});return r.a.createElement("div",{className:"tiles-container"},i.map(function(e){return r.a.createElement(ce,{key:"tile-".concat(e.id),tile:e})}))}}]),t}(i.Component))||L,de=function(e){var t=e.title,n=e.onClose;return r.a.createElement("div",{className:"pop-over"},r.a.createElement("div",{className:"pop-over-inner"},r.a.createElement("div",{className:"close-btn",onClick:n},r.a.createElement("img",{src:"/img/cross.svg",alt:"X"})),!!t&&r.a.createElement("div",{className:"title"},t)))},fe=_.a.div({scoreUpdate:{scale:1,transition:{scale:function(){return{type:"keyframes",times:[0,.5,1],values:[1,1.3,1],duration:225}}}}}),ve=function(e){var t=e.score;return r.a.createElement("div",{className:"game-interface"},r.a.createElement("div",{className:"game-score"},"Score: "," ",r.a.createElement(fe,{className:"score",pose:"scoreUpdate",poseKey:t},t)))},me=Object(l.b)("game")(N=Object(l.c)(N=function(e){function t(){var e,n;Object(s.a)(this,t);for(var i=arguments.length,r=new Array(i),a=0;a<i;a++)r[a]=arguments[a];return(n=Object(u.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={isWinMessageShown:!1,isMoveAvailableMessageShown:!1},n.createNewField=function(){(0,n.props.game.createField)({x:k,y:j})},n.onIsWinChange=function(e){e.newValue&&n.setState({isWinMessageShown:!0})},n.onIsMoveAvailable=function(e){e.newValue||n.setState({isMoveAvailableMessageShown:!0})},n.onWinMessageClose=function(){n.setState({isWinMessageShown:!1})},n.onMoveAvailableMessageClose=function(){n.setState({isMoveAvailableMessageShown:!1}),n.createNewField()},n.onKeyPress=function(e){var t=n.props.game,i=t.mergeToLeft,r=t.mergeToRight,a=t.mergeToUp,o=t.mergeToDown,l=e.keyCode,s=n.state,c=s.isWinMessageShown,u=s.isMoveAvailableMessageShown;if(!c&&!u)switch(!0){case[65,37].includes(l):i();break;case[87,38].includes(l):a();break;case[83,40].includes(l):o();break;case[68,39].includes(l):r();break;default:return}},n}return Object(f.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){var e=this.props.game,t=e.subscribeOnWin,n=e.subscribeOnIsMoveAvailable;this.createNewField(),this.onWinChangeDisposer=t(this.onIsWinChange),this.onIsMoveAvailableDisposer=n(this.onIsMoveAvailable),document.addEventListener("keydown",this.onKeyPress,!1)}},{key:"componentWillUnmount",value:function(){document.removeEventListener("keydown",this.onKeyPress,!1),this.onWinChangeDisposer(),this.onIsMoveAvailableDisposer()}},{key:"render",value:function(){var e=this.props.game,t=e.field,n=e.removed,i=e.score,a=this.state,o=a.isWinMessageShown,l=a.isMoveAvailableMessageShown;return t?r.a.createElement("div",{className:"game-container"},r.a.createElement(ve,{score:i}),r.a.createElement("div",{className:"game"},r.a.createElement(ue,{field:t,removed:n}),r.a.createElement(X,{x:k,y:j}),o&&r.a.createElement(de,{title:"You Won!",onClose:this.onWinMessageClose}),l&&r.a.createElement(de,{title:"Game over",onClose:this.onMoveAvailableMessageClose}))):null}}]),t}(i.Component))||N)||N,be=n(1),ge=n(2),he=n(3),ye=(n(33),S=function e(){var t=this;Object(s.a)(this,e),Object(ge.a)(this,"field",I,this),Object(ge.a)(this,"isFieldFull",P,this),Object(ge.a)(this,"removed",z,this),Object(ge.a)(this,"isAlreadyWin",R,this),Object(ge.a)(this,"isWin",B,this),Object(ge.a)(this,"score",D,this),Object(ge.a)(this,"isMoveAvailable",U,this),Object(ge.a)(this,"resetGame",K,this),Object(ge.a)(this,"createField",G,this),this.mergeTiles=function(e){var n=e.dir;return function(){var e=V.mergeTilesTo,i=V.addTile,r=V.isFieldsEqual,a=V.isWinCheck,o=V.isMoveAvailableCheck,l=e(t.field,{dir:n});if(!r(t.field,l.field)){var s=i({field:l.field,amount:1}),c=s.field,u=s.isFieldFull,d=o(c),f=a(c);t.isAlreadyWin&&(t.isWin=!1),f&&!t.isAlreadyWin&&(t.isWin=f,t.isAlreadyWin=!0),t.field=c,t.isFieldFull=u,t.removed=l.removed,t.score=t.score+l.score,t.isMoveAvailable=d}}},this.subscribeOnChange=function(e){return function(n){return Object(be.l)(t,e,n)}},this.subscribeOnWin=this.subscribeOnChange("isWin"),this.subscribeOnIsMoveAvailable=this.subscribeOnChange("isMoveAvailable"),Object(ge.a)(this,"mergeToLeft",Y,this),Object(ge.a)(this,"mergeToRight",q,this),Object(ge.a)(this,"mergeToUp",H,this),Object(ge.a)(this,"mergeToDown",J,this)},I=Object(he.a)(S.prototype,"field",[be.k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),P=Object(he.a)(S.prototype,"isFieldFull",[be.k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),z=Object(he.a)(S.prototype,"removed",[be.k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),R=Object(he.a)(S.prototype,"isAlreadyWin",[be.k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),B=Object(he.a)(S.prototype,"isWin",[be.k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),D=Object(he.a)(S.prototype,"score",[be.k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),U=Object(he.a)(S.prototype,"isMoveAvailable",[be.k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),K=Object(he.a)(S.prototype,"resetGame",[be.d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(){e.field=null,e.isFieldFull=!1,e.removed=null,e.isAlreadyWin=!1,e.isWin=!1,e.score=0,e.isMoveAvailable=!0}}}),G=Object(he.a)(S.prototype,"createField",[be.d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.x,i=void 0===n?4:n,r=t.y,a=void 0===r?4:r;e.resetGame();var o=V.getEmptyField,l=(0,V.addTile)({field:o({x:i,y:a}),amount:2}).field;e.field=l}}}),Y=Object(he.a)(S.prototype,"mergeToLeft",[be.d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return this.mergeTiles({dir:E})}}),q=Object(he.a)(S.prototype,"mergeToRight",[be.d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return this.mergeTiles({dir:x})}}),H=Object(he.a)(S.prototype,"mergeToUp",[be.d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return this.mergeTiles({dir:A})}}),J=Object(he.a)(S.prototype,"mergeToDown",[be.d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return this.mergeTiles({dir:M})}}),S);Object(be.e)({enforceActions:"observed"});var pe={game:new ye};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));n(34);o.a.render(r.a.createElement(l.a,pe,r.a.createElement(me,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[21,1,2]]]);
//# sourceMappingURL=main.33b7f09a.chunk.js.map